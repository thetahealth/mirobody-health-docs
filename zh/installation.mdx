---
title: "安装指南"
description: "在不同平台上安装 Mirobody Health 的详细说明"
---

## 安装方法

选择最适合您需求的安装方法：

<Tabs>
  <Tab title="Docker (推荐)">
    无论是开发环境还是生产环境，Docker 部署都是推荐的方法。

    ### 第 1 步：安装 Docker

    <Tabs>
      <Tab title="macOS">
        下载并安装 [Docker Desktop for Mac](https://www.docker.com/products/docker-desktop)：

        ```bash
        brew install --cask docker
        ```

        从应用程序文件夹启动 Docker Desktop。
      </Tab>

      <Tab title="Linux">
        安装 Docker Engine 和 Docker Compose：

        ```bash
        # Ubuntu/Debian
        curl -fsSL https://get.docker.com -o get-docker.sh
        sudo sh get-docker.sh
        
        # 将您的用户添加到 docker 组
        sudo usermod -aG docker $USER
        
        # 安装 Docker Compose 插件
        sudo apt-get install docker-compose-plugin
        ```

        注销并重新登录以使组更改生效。
      </Tab>

      <Tab title="Windows">
        安装 [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)：

        1. 下载安装程序
        2. 运行安装程序
        3. 启用 WSL 2 集成
        4. 重启计算机

        <Warning>
        Windows 需要 WSL 2 才能获得最佳的 Docker 性能。
        </Warning>
      </Tab>
    </Tabs>

    ### 第 2 步：克隆仓库

    ```bash
    git clone https://github.com/thetahealth/mirobody-health.git
    cd mirobody-health
    ```

    ### 第 3 步：配置环境

    创建配置文件：

    ```bash
    cp .env.example .env
    cp config.yaml config.localdb.yaml
    ```

    编辑 `.env` 设置您的环境：

    ```bash
    ENV=localdb
    ```

    在 `config.localdb.yaml` 中添加至少一个 LLM API 密钥：

    ```yaml
    # ============ LLM API 密钥 (至少需要一个) ============
    GOOGLE_API_KEY: ''      # 用于 Gemini 模型
    OPENAI_API_KEY: ''      # 用于 GPT 模型  
    OPENROUTER_API_KEY: ''  # 用于 Claude、DeepSeek 等模型
    
    # ============ Agent 配置 ============
    MCP_TOOL_DIRS:
      - mirobody/pub/tools
      - mirobody/pub/tools_health
    
    MCP_RESOURCE_DIRS:
      - mirobody/pub/resources
    
    AGENT_DIRS:
      - mirobody/pub/agents
    ```

    ### 第 4 步：部署

    ```bash
    ./run.sh
    ```

    <Check>
    部署脚本将构建并启动所有必需的服务。
    </Check>
  </Tab>

  <Tab title="源码安装">
    从源码构建并运行，适用于开发和自定义。

    ### 第 1 步：克隆与设置

    ```bash
    git clone https://github.com/thetahealth/mirobody-health.git
    cd mirobody-health
    
    # 创建虚拟环境
    python3.12 -m venv venv
    source venv/bin/activate
    ```

    ### 第 2 步：安装系统依赖

    <Tabs>
      <Tab title="macOS">
        ```bash
        xcode-select --install
        brew install gcc gfortran fftw hdf5 openblas lapack
        ```
      </Tab>

      <Tab title="Linux (Ubuntu/Debian)">
        ```bash
        sudo apt install -y g++ gfortran build-essential \
          libfftw3-dev libhdf5-dev libblas-dev liblapack-dev
        ```
      </Tab>
    </Tabs>

    ### 第 3 步：安装 Python 依赖

    ```bash
    pip install mirobody -r requirements.txt
    ```

    ### 第 4 步：安装 Node.js 依赖

    ```bash
    npm install @antv/gpt-vis-ssr ws
    ```

    ### 第 5 步：设置外部服务

    启动 PostgreSQL 和 Redis（为简单起见使用 Docker）：

    ```bash
    docker-compose up -d postgres redis
    ```

    ### 第 6 步：配置

    ```bash
    cp .env.example .env
    cp config.yaml config.localdb.yaml
    ```

    编辑 `.env`：

    ```bash
    ENV=localdb
    ```

    在 `config.localdb.yaml` 中添加至少一个 API 密钥和数据库设置：

    ```yaml
    # ============ LLM API 密钥 (至少需要一个) ============
    GOOGLE_API_KEY: ''
    OPENAI_API_KEY: ''
    OPENROUTER_API_KEY: ''
    
    # ============ 数据库配置 ============
    PG_HOST: 'localhost'
    PG_PORT: 5432
    PG_USER: ''
    PG_PASSWORD: ''
    PG_DBNAME: ''
    PG_SCHEMA: ''
    
    # ============ Redis 配置 ============
    REDIS_HOST: 'localhost'
    REDIS_PORT: 6379
    REDIS_DB: 0
    REDIS_PASSWORD: ''
    ```

    ### 第 7 步：运行

    ```bash
    python main.py
    ```

    <Check>
    服务器应在 http://localhost:18080 启动。如果是在 WSL 下运行，可通过 Windows 访问 `http://localhost:18080`。
    </Check>
  </Tab>
</Tabs>

## 验证安装

安装完成后，验证一切运行正常：

<Steps>
  <Step title="检查服务健康状况">
    ```bash
    curl http://localhost:18080/health
    ```

    预期响应：

    ```json
    {
      "status": "healthy",
      "version": "1.0.1",
      "services": {
        "database": "connected",
        "redis": "connected"
      }
    }
    ```
  </Step>

  <Step title="列出可用提供商">
    ```bash
    curl http://localhost:18080/api/v1/pulse/providers
    ```

    应返回可用健康提供商的列表。
  </Step>

  <Step title="检查日志">
    查看应用程序日志以确保没有错误：

    ```bash
    # Docker 部署
    docker-compose logs -f backend
    
    # 直接安装
    # 日志将显示在您运行 main.py 的终端中
    ```
  </Step>
</Steps>

## 安装后设置

<AccordionGroup>
  <Accordion title="配置数据提供商 (Providers)" icon="key">
    要启用健康设备集成，您需要从每个提供商处获取 OAuth 凭据。

    有关获取和设置以下提供商的 OAuth 凭据的详细说明，请参阅[配置指南](/zh/configuration)：
    - Garmin Connect
    - Whoop
    - 自定义提供商
  </Accordion>

  <Accordion title="设置 AI 对话与 Agent" icon="robot">
    要启用 AI 功能，请在 `config.localdb.yaml` 中添加至少一个 API 密钥：

    ```yaml
    # ============ LLM API 密钥 (至少需要一个) ============
    GOOGLE_API_KEY: ''      # 用于 Gemini 模型
    OPENAI_API_KEY: ''      # 用于 GPT 模型
    OPENROUTER_API_KEY: ''  # 用于 Claude、DeepSeek 等模型
    
    # ============ Agent 配置 ============
    MCP_TOOL_DIRS:
      - mirobody/pub/tools
      - mirobody/pub/tools_health
    
    MCP_RESOURCE_DIRS:
      - mirobody/pub/resources
    
    AGENT_DIRS:
      - mirobody/pub/agents
    ```

    <Info>
    Mirobody Health 包含两种 Agent 类型：
    - **DeepAgent** (基于 LangChain): 最适合复杂任务、文件操作、多步骤规划
    - **BaselineAgent** (原生 Gemini): 最适合简单对话、轻量级 MCP 集成
    
    有关配置详情，请参阅 [工具概览](/zh/tools/overview)。
    </Info>
  </Accordion>

  <Accordion title="配置数据库加密" icon="lock">
    对于生产环境，请设置安全的加密密钥：

    ```yaml
    DATABASE_DECRYPTION_KEY: '您的_32_位加密密钥'
    JWT_KEY: '您的_安全_JWT_密钥'
    ```

    <Warning>
    在生产环境中使用强随机生成的密钥。切勿将这些密钥提交到版本控制系统中。
    </Warning>
  </Accordion>

  <Accordion title="设置云存储 (可选)" icon="cloud">
    配置兼容 S3 的存储用于数据备份：

    ```yaml
    S3_KEY: '您的访问密钥'
    S3_TOKEN: '您的私钥'
    S3_REGION: 'us-east-1'
    S3_BUCKET: '您的存储桶名称'
    ```
  </Accordion>
</AccordionGroup>

## 目录结构

安装后，您的目录结构将如下所示：

```
mirobody-health/
├── mirobody/                  # 主应用程序包
│   ├── chat/                 # 聊天和 Agent 服务
│   ├── mcp/                  # MCP 协议实现
│   ├── pulse/                # 健康数据提供商
│   │   ├── theta/           # OAuth 提供商 (Garmin, Whoop 等)
│   │   ├── apple/           # Apple 健康平台
│   │   ├── core/            # 核心健康数据服务
│   │   └── file_parser/     # 文件处理程序
│   ├── pub/                  # 公共工具和 Agent
│   │   ├── tools/           # 通用 MCP 工具
│   │   ├── tools_health/    # 健康专用 MCP 工具
│   │   ├── resources/       # MCP 资源
│   │   └── agents/          # Agent 实现
│   ├── server/               # HTTP 服务器
│   ├── user/                 # 用户身份验证
│   └── utils/                # 实用程序
├── database/                  # 数据库模式和迁移
│   └── resource/             # SQL 初始化文件
├── image/                     # Logo 和品牌资产
├── compose.yaml              # Docker Compose 配置
├── config.yaml               # 基础配置 (不可更改)
├── config.localdb.yaml       # 您的环境配置
├── .env                      # 环境变量
├── main.py                   # 应用程序入口
├── requirements.txt          # Python 依赖
├── package.json              # Node.js 依赖
├── run.sh                    # 部署脚本
└── README.md                 # 文档
```

## 安装问题排查

<AccordionGroup>
  <Accordion title="Docker 安装失败" icon="docker">
    **问题**: Docker 命令因权限错误而失败。

    **解决方案**:
    ```bash
    # Linux: 将用户添加到 docker 组
    sudo usermod -aG docker $USER
    
    # 注销并重新登录
    newgrp docker
    ```
  </Accordion>

  <Accordion title="端口冲突" icon="network-wired">
    **问题**: 端口 18080 已被占用。

    **解决方案**: 在 `config.localdb.yaml` 中更改端口：
    ```yaml
    HTTP_PORT: 18081  # 使用任何可用端口
    ```
  </Accordion>

  <Accordion title="数据库连接失败" icon="database">
    **问题**: 无法连接到 PostgreSQL。

    **解决方案**:
    1. 验证 PostgreSQL 正在运行：
       ```bash
       docker-compose ps postgres
       ```

    2. 检查 `config.localdb.yaml` 中的连接设置：
       ```yaml
       PG_HOST: db  # Docker 环境使用 'db'，本地安装使用 'localhost'
       PG_PORT: 5432
       PG_USER: holistic_user
       PG_DBNAME: holistic_db
       ```

    3. 检查数据库日志：
       ```bash
       docker-compose logs postgres
       ```
  </Accordion>

  <Accordion title="Python 版本不匹配" icon="python">
    **问题**: Python 3.12 不可用。

    **解决方案**:

    <Tabs>
      <Tab title="macOS">
        ```bash
        brew install python@3.12
        ```
      </Tab>

      <Tab title="Linux">
        ```bash
        # Ubuntu/Debian
        sudo add-apt-repository ppa:deadsnakes/ppa
        sudo apt-get update
        sudo apt-get install python3.12
        ```
      </Tab>

      <Tab title="Windows">
        从 [python.org](https://www.python.org/downloads/) 下载或使用 `pyenv`:
        ```bash
        pyenv install 3.12
        pyenv global 3.12
        ```
      </Tab>
    </Tabs>
  </Accordion>

  <Accordion title="模块导入错误" icon="code">
    **问题**: 运行应用程序时出现 `ModuleNotFoundError`。

    **解决方案**:
    ```bash
    # 确保安装了所有依赖项
    pip install -r requirements.txt
    
    # 以开发模式安装
    pip install -e .
    ```
  </Accordion>
</AccordionGroup>

## 卸载

<Tabs>
  <Tab title="Docker">
    删除所有容器、卷和镜像：

    ```bash
    # 停止并删除容器
    docker-compose down
    
    # 删除卷 (警告: 这将删除所有数据)
    docker-compose down -v
    
    # 删除镜像
    docker-compose down --rmi all
    ```
  </Tab>

  <Tab title="源码安装">
    ```bash
    # 停用虚拟环境
    deactivate
    
    # 删除项目目录
    cd ..
    rm -rf mirobody-health
    ```
  </Tab>
</Tabs>

## 下一步

<CardGroup cols={2}>
  <Card title="配置指南" icon="gear" href="/zh/configuration">
    配置 OAuth 提供商并自定义设置
  </Card>
  <Card title="快速开始" icon="rocket" href="/zh/quickstart">
    按照快速开始指南测试您的安装
  </Card>
  <Card title="核心概念" icon="diagram-project" href="/zh/concepts/architecture">
    了解 Mirobody Health 的工作原理
  </Card>
  <Card title="开发环境" icon="code" href="/zh/development/setup">
    搭建您的开发环境
  </Card>
</CardGroup>
