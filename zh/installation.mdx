---
title: "安装"
description: "在不同平台上安装 Mirobody Health 的详细指南"
---

## 安装方式

选择最适合你需求的安装方式：

<Tabs>
  <Tab title="Docker (Recommended)">
    Docker 部署适用于开发与生产环境，也是推荐方式。

    ### Step 1：安装 Docker

    <Tabs>
      <Tab title="macOS">
        下载并安装 [Docker Desktop for Mac](https://www.docker.com/products/docker-desktop)：

        ```bash
        brew install --cask docker
        ```

        从 Applications 文件夹启动 Docker Desktop。
      </Tab>

      <Tab title="Linux">
        安装 Docker Engine 与 Docker Compose：

        ```bash
        # Ubuntu/Debian
        curl -fsSL https://get.docker.com -o get-docker.sh
        sudo sh get-docker.sh
        
        # Add your user to docker group
        sudo usermod -aG docker $USER
        
        # Install Docker Compose
        sudo apt-get install docker-compose-plugin
        ```

        退出并重新登录使用户组变更生效。
      </Tab>

      <Tab title="Windows">
        Install [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop):

        1. Download the installer
        2. Run the installer
        3. Enable WSL 2 integration
        4. Restart your computer

        <Warning>
        Windows 需要 WSL 2 才能获得最佳 Docker 性能。
        </Warning>
      </Tab>
    </Tabs>

    ### Step 2：克隆仓库

    ```bash
    git clone https://github.com/thetahealth/mirobody-health.git
    cd mirobody-health
    ```

    ### Step 3：配置环境

    创建配置文件：

    ```bash
    cp .env.example .env
    cp config.yaml config.localdb.yaml
    ```

    编辑 `.env` 设置你的环境：

    ```bash
    ENV=localdb
    ```

    添加至少一个 LLM API key 到 `config.localdb.yaml`：

    ```yaml
    # ============ LLM API Keys (至少需要一个) ============
    GOOGLE_API_KEY: ''      # 用于 Gemini 模型
    OPENAI_API_KEY: ''      # 用于 GPT 模型  
    OPENROUTER_API_KEY: ''  # 用于 Claude、DeepSeek 等模型
    
    # ============ Agent 配置 ============
    MCP_TOOL_DIRS:
      - mirobody/pub/tools
      - mirobody/pub/tools_health
    
    MCP_RESOURCE_DIRS:
      - mirobody/pub/resources
    
    AGENT_DIRS:
      - mirobody/pub/agents
    ```

    ### Step 4：部署

    ```bash
    ./run.sh
    ```

    <Check>
    部署脚本会构建并启动所需的全部服务。
    </Check>
  </Tab>

  <Tab title="From Source">
    从源码构建运行，适用于开发与深度定制。

    ### Step 1：克隆并初始化

    ```bash
    git clone https://github.com/thetahealth/mirobody-health.git
    cd mirobody-health
    
    # Create virtual environment
    python3.12 -m venv venv
    source venv/bin/activate
    ```

    ### Step 2：安装系统依赖

    <Tabs>
      <Tab title="macOS">
        ```bash
        xcode-select --install
        brew install gcc gfortran fftw hdf5 openblas lapack
        ```
      </Tab>

      <Tab title="Linux (Ubuntu/Debian)">
        ```bash
        sudo apt install -y g++ gfortran build-essential \
          libfftw3-dev libhdf5-dev libblas-dev liblapack-dev
        ```
      </Tab>
    </Tabs>

    ### Step 3：安装 Python 依赖

    ```bash
    pip install mirobody -r requirements.txt
    ```

    ### Step 4：安装 Node.js 依赖

    ```bash
    npm install @antv/gpt-vis-ssr ws
    ```

    ### Step 5：启动外部服务

    启动 PostgreSQL 与 Redis（为简单起见使用 Docker）：

    ```bash
    docker-compose up -d postgres redis
    ```

    ### Step 6：配置

    ```bash
    cp .env.example .env
    cp config.yaml config.localdb.yaml
    ```

    编辑 `.env`：

    ```bash
    ENV=localdb
    ```

    添加至少一个 API key 和数据库设置到 `config.localdb.yaml`：

    ```yaml
    # ============ LLM API Keys (至少需要一个) ============
    GOOGLE_API_KEY: ''
    OPENAI_API_KEY: ''
    OPENROUTER_API_KEY: ''
    
    # ============ 数据库配置 ============
    PG_HOST: 'localhost'
    PG_PORT: 5432
    PG_USER: ''
    PG_PASSWORD: ''
    PG_DBNAME: ''
    PG_SCHEMA: ''
    
    # ============ Redis 配置 ============
    REDIS_HOST: 'localhost'
    REDIS_PORT: 6379
    REDIS_DB: 0
    REDIS_PASSWORD: ''
    ```

    ### Step 7：运行

    ```bash
    python main.py
    ```

    <Check>
    服务应启动于 http://localhost:18080。如果在 WSL 下运行，从 Windows 通过 `http://localhost:18080` 访问。
    </Check>
  </Tab>
</Tabs>

## 验证安装

安装完成后，请验证各项功能是否正常：

<Steps>
  <Step title="检查服务健康状态">
    ```bash
    curl http://localhost:18080/health
    ```

    期望响应：

    ```json
    {
      "status": "healthy",
      "version": "1.0.1",
      "services": {
        "database": "connected",
        "redis": "connected"
      }
    }
    ```
  </Step>

  <Step title="列出可用 providers">
    ```bash
    curl http://localhost:18080/api/v1/pulse/providers
    ```

    应返回可用健康 providers 列表。
  </Step>

  <Step title="查看日志">
    查看应用日志，确保没有错误：

    ```bash
    # Docker deployment
    docker-compose logs -f backend
    
    # Direct installation
    # 日志会输出在运行 main.py 的终端中
    ```
  </Step>
</Steps>

## 安装后配置

<AccordionGroup>
  <Accordion title="配置数据 Providers" icon="key">
    要启用健康设备集成，你需要为每个 provider 准备 OAuth 凭据。

    获取与配置 OAuth 凭据的详细说明请参见[配置指南](/zh/configuration)，包括：
    - Garmin Connect
    - Whoop
    - 自定义 providers
  </Accordion>

  <Accordion title="配置 AI 对话与 Agents" icon="robot">
    要启用 AI 功能，添加至少一个 API key 到 `config.localdb.yaml`：

    ```yaml
    # ============ LLM API Keys (至少需要一个) ============
    GOOGLE_API_KEY: ''      # 用于 Gemini 模型
    OPENAI_API_KEY: ''      # 用于 GPT 模型
    OPENROUTER_API_KEY: ''  # 用于 Claude、DeepSeek 等模型
    
    # ============ Agent 配置 ============
    MCP_TOOL_DIRS:
      - mirobody/pub/tools
      - mirobody/pub/tools_health
    
    MCP_RESOURCE_DIRS:
      - mirobody/pub/resources
    
    AGENT_DIRS:
      - mirobody/pub/agents
    ```

    <Info>
    Mirobody Health 包含两种 agent 类型：
    - **DeepAgent**（基于 LangChain）：适合复杂任务、文件操作、多步骤规划
    - **BaselineAgent**（原生 Gemini）：适合简单对话、轻量级 MCP 集成
    
    详见[Tools 概览](/zh/tools/overview)了解配置细节。
    </Info>
  </Accordion>

  <Accordion title="配置数据库加密" icon="lock">
    生产环境请设置安全的加密 key：

    ```yaml
    DATABASE_DECRYPTION_KEY: 'your_32_char_encryption_key'
    JWT_KEY: 'your_secure_jwt_secret'
    ```

    <Warning>
    生产环境请使用强度高且随机生成的 key，切勿提交到版本控制系统。
    </Warning>
  </Accordion>

  <Accordion title="配置云存储（可选）" icon="cloud">
    配置兼容 S3 的存储用于数据备份：

    ```yaml
    S3_KEY: 'your_access_key'
    S3_TOKEN: 'your_secret_key'
    S3_REGION: 'us-east-1'
    S3_BUCKET: 'your-bucket-name'
    ```
  </Accordion>
</AccordionGroup>

## 目录结构

安装完成后，目录结构大致如下：

```
mirobody-health/
├── mirobody/                  # 主应用包
│   ├── chat/                 # 对话与 agent 服务
│   ├── mcp/                  # MCP 协议实现
│   ├── pulse/                # 健康数据 providers
│   │   ├── theta/           # OAuth providers（Garmin、Whoop 等）
│   │   ├── apple/           # Apple Health 平台
│   │   ├── core/            # 核心健康数据服务
│   │   └── file_parser/     # 文件处理处理器
│   ├── pub/                  # 公共 tools 与 agents
│   │   ├── tools/           # 通用 MCP tools
│   │   ├── tools_health/    # 健康专用 MCP tools
│   │   ├── resources/       # MCP resources
│   │   └── agents/          # Agent 实现
│   ├── server/               # HTTP 服务器
│   ├── user/                 # 用户认证
│   └── utils/                # 工具函数
├── database/                  # 数据库 schemas 与迁移
│   └── resource/             # SQL 初始化文件
├── image/                     # Logo 与品牌资源
├── compose.yaml              # Docker Compose 配置
├── config.yaml               # 基础配置（不可变）
├── config.localdb.yaml       # 你的环境配置
├── .env                      # 环境变量
├── main.py                   # 应用入口
├── requirements.txt          # Python 依赖
├── package.json              # Node.js 依赖
├── run.sh                    # 部署脚本
└── README.md                 # 文档
```

## 安装问题排查

<AccordionGroup>
  <Accordion title="Docker 安装/运行失败" icon="docker">
    **Problem**：Docker 命令因权限问题失败。

    **Solution**：
    ```bash
    # Linux: Add user to docker group
    sudo usermod -aG docker $USER
    
    # Log out and back in
    newgrp docker
    ```
  </Accordion>

  <Accordion title="端口冲突" icon="network-wired">
    **Problem**：端口 18080 已被占用。

    **Solution**：在 `config.localdb.yaml` 中修改端口：
    ```yaml
    HTTP_PORT: 18081  # 使用任意可用端口
    ```
  </Accordion>

  <Accordion title="数据库连接失败" icon="database">
    **Problem**：无法连接 PostgreSQL。

    **Solutions**：
    1. 确认 PostgreSQL 正在运行：
       ```bash
       docker-compose ps postgres
       ```

    2. 检查 `config.localdb.yaml` 中的连接配置：
       ```yaml
       PG_HOST: db  # Docker 使用 'db'，本地安装使用 'localhost'
       PG_PORT: 5432
       PG_USER: holistic_user
       PG_DBNAME: holistic_db
       ```

    3. 查看数据库日志：
       ```bash
       docker-compose logs postgres
       ```
  </Accordion>

  <Accordion title="Python 版本不匹配" icon="python">
    **Problem**：系统没有 Python 3.12。

    **Solutions**：

    <Tabs>
      <Tab title="macOS">
        ```bash
        brew install python@3.12
        ```
      </Tab>

      <Tab title="Linux">
        ```bash
        # Ubuntu/Debian
        sudo add-apt-repository ppa:deadsnakes/ppa
        sudo apt-get update
        sudo apt-get install python3.12
        ```
      </Tab>

      <Tab title="Windows">
        从 [python.org](https://www.python.org/downloads/) 下载或使用 `pyenv`：
        ```bash
        pyenv install 3.12
        pyenv global 3.12
        ```
      </Tab>
    </Tabs>
  </Accordion>

  <Accordion title="模块导入错误" icon="code">
    **Problem**：运行应用时出现 `ModuleNotFoundError`。

    **Solution**：
    ```bash
    # Ensure all dependencies are installed
    pip install -r requirements.txt
    
    # Install in development mode
    pip install -e .
    ```
  </Accordion>
</AccordionGroup>

## 卸载

<Tabs>
  <Tab title="Docker">
    删除所有容器、卷与镜像：

    ```bash
    # Stop and remove containers
    docker-compose down
    
    # Remove volumes (WARNING: This deletes all data)
    docker-compose down -v
    
    # Remove images
    docker-compose down --rmi all
    ```
  </Tab>

  <Tab title="Source Installation">
    ```bash
    # Deactivate virtual environment
    deactivate
    
    # Remove project directory
    cd ..
    rm -rf mirobody-health
    ```
  </Tab>
</Tabs>

## 下一步

<CardGroup cols={2}>
  <Card title="Configuration" icon="gear" href="/zh/configuration">
    配置 OAuth providers 并自定义系统设置
  </Card>
  <Card title="Quick Start" icon="rocket" href="/zh/quickstart">
    按照快速开始指南验证安装
  </Card>
  <Card title="Architecture" icon="diagram-project" href="/zh/concepts/architecture">
    了解 Mirobody Health 的工作原理
  </Card>
  <Card title="Development" icon="code" href="/zh/development/setup">
    搭建开发环境
  </Card>
</CardGroup>
